<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Just Us ðŸ’š</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:#ece5dd;
}
.dark{background:#0b141a}
.hidden{display:none}

/* HEADER */
.header{
  background:#075e54;
  color:white;
  padding:12px;
  text-align:center;
  font-weight:bold;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.dark .header{background:#1f2c34}

/* LOGIN */
#loginBox{
  max-width:360px;
  margin:60px auto;
  background:white;
  padding:20px;
  border-radius:8px;
}
.dark #loginBox{background:#1f2c34;color:white}

input,button{
  width:100%;
  padding:10px;
  margin-top:8px;
  border-radius:5px;
  border:1px solid #ccc;
}
button{
  background:#25d366;
  border:none;
  color:white;
  font-weight:bold;
}

/* CHAT */
#chat{height:100vh}
#messages{
  height:calc(100vh - 160px);
  overflow-y:auto;
  padding:10px;
}

/* BUBBLES */
.me{
  max-width:75%;
  margin-left:auto;
  background:#dcf8c6;
  padding:8px;
  border-radius:8px 0 8px 8px;
  margin-bottom:6px;
}
.her{
  max-width:75%;
  background:white;
  padding:8px;
  border-radius:0 8px 8px 8px;
  margin-bottom:6px;
}
.dark .me{background:#005c4b;color:white}
.dark .her{background:#202c33;color:white}

.time{font-size:10px;color:#555;text-align:right}
.seen{font-size:10px;color:#4fc3f7}
#typing{padding-left:12px;font-size:12px;color:#555}

/* INPUT */
.footer{
  display:flex;
  padding:8px;
  background:#f0f0f0;
}
.dark .footer{background:#1f2c34}

#msg{
  flex:1;
  padding:10px;
  border-radius:20px;
  border:1px solid #ccc;
}
.sendBtn{
  margin-left:6px;
  background:#25d366;
  border:none;
  color:white;
  border-radius:50%;
  width:45px;
  height:45px;
  font-size:18px;
}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="loginBox">
  <h3 align="center">Private Chat ðŸ’š</h3>
  <input id="email" placeholder="Email">
  <input id="password" type="password" placeholder="Password">
  <button onclick="login()">Login</button>
</div>

<!-- CHAT (LOCKED) -->
<div id="chat" class="hidden">
  <div class="header">
    Just Us ðŸ’š
    <button onclick="toggleDark()">ðŸŒ™</button>
  </div>

  <div id="messages"></div>
  <div id="typing"></div>

  <div class="footer">
    <input id="msg" placeholder="Type a message">
    <button class="sendBtn" onclick="send()">âž¤</button>
  </div>
</div>

<audio id="sound" src="https://www.fesliyanstudios.com/play-mp3/387"></audio>

<script type="module">
/* Firebase SDKs */
import { initializeApp } from
"https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";

import {
  getAuth,
  signInWithEmailAndPassword,
  onAuthStateChanged,
  setPersistence,
  browserSessionPersistence
} from
"https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";

import {
  getDatabase,
  ref,
  push,
  onChildAdded,
  update,
  set,
  remove,
  onValue
} from
"https://www.gstatic.com/firebasejs/12.7.0/firebase-database.js";

/* ðŸ” FIREBASE CONFIG (YOUR PROJECT) */
const firebaseConfig = {
  apiKey: "AIzaSyBd14pfFYZVkAIDHumbRwo4qP79QRz0Os0",
  authDomain: "jss1207.firebaseapp.com",
  databaseURL: "https://jss1207-default-rtdb.firebaseio.com",
  projectId: "jss1207",
  storageBucket: "jss1207.firebasestorage.app",
  messagingSenderId: "121988951850",
  appId: "1:121988951850:web:f8af63653cab1bd8eb3853"
};

/* INIT */
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getDatabase(app);

/* ðŸ”’ FORCE LOGIN EVERY TIME */
setPersistence(auth, browserSessionPersistence);

/* LOGIN */
window.login = ()=>{
  signInWithEmailAndPassword(auth,email.value,password.value)
  .catch(()=>alert("Wrong email or password âŒ"));
};

/* AUTH GUARD */
onAuthStateChanged(auth,user=>{
  if(!user){
    chat.classList.add("hidden");
    loginBox.classList.remove("hidden");
    return;
  }

  loginBox.classList.add("hidden");
  chat.classList.remove("hidden");
  messages.innerHTML="";

  const messagesRef = ref(db,"messages");

  onChildAdded(messagesRef,snap=>{
    const m=snap.val();
    const div=document.createElement("div");
    div.className =
      m.uid===auth.currentUser.uid ? "me":"her";

    const t=new Date(m.time).toLocaleTimeString([],{
      hour:'2-digit',minute:'2-digit'
    });

    div.innerHTML=`
      ${m.text}
      <div class="time">
        ${t}
        ${m.uid===auth.currentUser.uid
          ? `<span class="seen">${m.seen?" âœ“âœ“":" âœ“"}</span>`:""}
      </div>`;

    messages.appendChild(div);
    messages.scrollTop=messages.scrollHeight;

    if(m.uid!==auth.currentUser.uid && !m.seen){
      update(ref(db,"messages/"+snap.key),{seen:true});
      sound.play();
    }
  });
});

/* SEND MESSAGE */
window.send=()=>{
  if(msg.value.trim()==="")return;
  push(ref(db,"messages"),{
    text:msg.value,
    uid:auth.currentUser.uid,
    time:Date.now(),
    seen:false
  });
  msg.value="";
};

/* TYPING */
msg.oninput=()=>{
  set(ref(db,"typing/"+auth.currentUser.uid),true);
  setTimeout(()=>remove(ref(db,"typing/"+auth.currentUser.uid)),1500);
};

onValue(ref(db,"typing"),snap=>{
  typing.innerText = snap.size>1 ? "Typing..." : "";
});

/* DARK MODE */
window.toggleDark=()=>{
  document.body.classList.toggle("dark");
};
</script>

</body>
</html>